(() => { "use strict"; var e = {}; e.g = function () { if ("object" == typeof globalThis) return globalThis; try { return this || new Function("return this")() } catch (e) { if ("object" == typeof window) return window } }(), (() => { var t; e.g.importScripts && (t = e.g.location + ""); var o = e.g.document; if (!t && o && (o.currentScript && (t = o.currentScript.src), !t)) { var r = o.getElementsByTagName("script"); r.length && (t = r[r.length - 1].src) } if (!t) throw new Error("Automatic publicPath is not supported in this browser"); t = t.replace(/#.*$/, "").replace(/\?.*$/, "").replace(/\/[^\/]+$/, "/"), e.p = t })(), e.p, e.p, e.p, e.p, e.p, e.p; const t = { Explosion1: new Howl({ src: "./audio/explosion_1.mp3", html5: !0 }), Explosion2: new Howl({ src: "./audio/explosion_2.mp3", html5: !0 }), Explosion3: new Howl({ src: "./audio/explosion_3.mp3", html5: !0 }), Click: new Howl({ src: "./audio/click.mp3", html5: !0 }), End: new Howl({ src: "./audio/end.mp3", html5: !0 }), Record: new Howl({ src: "./audio/record.mp3", html5: !0 }) }; vkBridge.send("VKWebAppInit"); const o = document.querySelector("canvas"), r = o.getContext("2d"), i = 360, s = 640 / i; o.width = i, o.height = 640; let n = 1; const l = document.querySelector(".wrapper"), a = document.querySelector(".score"), d = document.querySelector(".highscore"), c = document.querySelector(".result"), h = document.querySelector(".play"), u = document.querySelector(".home"), p = document.querySelector(".restart"), m = document.querySelector(".post"), g = document.querySelector(".invite"), y = document.querySelector(".volume"), f = document.querySelector(".group"), w = document.querySelector(".buttons"), v = document.querySelector(".screen--start"), k = document.querySelector(".screen--game"), S = document.querySelector(".screen--end"), x = document.querySelector(".preloader"); class b { constructor(e, t, o, r, i) { this.x = e, this.y = t, this.radius = o, this.speed = r, this.color = i, this.alpha = 1 } draw() { r.save(), r.globalAlpha = this.alpha, r.beginPath(), r.arc(this.x * n, this.y * n, this.radius * n, 0, 2 * Math.PI), r.fillStyle = this.color, r.fill(), r.strokeStyle = "rgb(17, 21, 66)", r.stroke(), r.closePath(), r.restore() } update() { this.draw(), this.y += this.speed } } class C { constructor(e, t, o, r, i) { this.x = e, this.y = t, this.radius = o, this.speed = r, this.color = i, this.alpha = 1 } draw() { r.save(), r.globalAlpha = this.alpha, r.beginPath(), r.arc(this.x * n, this.y * n, this.radius * n, 0, 2 * Math.PI), r.fillStyle = this.color, r.fill(), r.closePath(), r.restore() } update() { this.draw(), this.speed.x *= .98, this.speed.y *= .98, this.x += this.speed.x, this.y += this.speed.y, this.alpha -= .03 } } let E = !1, q = !0, A = 0, M = 0; vkBridge.send("VKWebAppStorageGet", { keys: ["userHighscore"] }).then((e => { e.keys[0].value.length || (e.keys[0].value = "0"), d.firstElementChild.textContent = e.keys[0].value, setTimeout((() => { x.classList.add("hidden") }), 2e3) })); let W = 1300, H = 1e3, B = 60, L = 70, V = 1.55; const K = ["--color-purple", "--color-blue", "--color-green", "--color-yellow", "--color-red"].map((e => getComputedStyle(document.documentElement).getPropertyValue(e).trimStart())), T = ["Explosion1", "Explosion2", "Explosion3"]; let P = [], $ = []; function _(e) { let t = Math.abs(e); return t %= 100, t >= 5 && t <= 20 ? "очков" : (t %= 10, 1 === t ? "очко" : t >= 2 && t <= 4 ? "очка" : "очков") } function G() { E = !1, P.forEach((e => { e.speed = 0 })), q && t.End.play(), W = 1300, H = 1e3, B = 60, L = 70, V = 1.55, N(null, "add", "left", [k]), setTimeout((() => { vkBridge.send("VKWebAppCheckNativeAds", { ad_format: "interstitial" }).then((() => { vkBridge.send("VKWebAppShowNativeAds", { ad_format: "interstitial" }) })), function () { const e = A; A = 0, vkBridge.send("VKWebAppStorageGet", { keys: ["userHighscore"] }).then((o => { e > o.keys[0].value && (M = e, vkBridge.send("VKWebAppStorageSet", { key: "userHighscore", value: String(M) }), d.firstElementChild.textContent = M, c.classList.add("record"), q && t.Record.play()) })), c.firstElementChild.textContent = e, a.textContent = 0, N(null, "remove", "right", [S]) }() }), 1e3) } function I(e, t) { e.classList.add("active"), setTimeout((() => { e.classList.remove("active") }), t) } function N(e, t, o, r) { let s; "start" !== e || E || (E = !0, setTimeout((() => { c.classList.remove("record"), function e() { const t = Math.random() * (W - H) + H; setTimeout((() => { if (E) { const t = Math.random() * (L - B) + B, o = t + 5, r = i - t - 5, s = Math.random() * (r - o) + o, n = -t, l = V, a = K[Math.floor(Math.random() * K.length)]; document.hidden || P.push(new b(s, n, t, l, a)), e() } }), t) }() }), 500)), s = "left" === o ? "hidden--left" : "hidden--right", function (e, t, o = 0, r) { setTimeout((() => { e.forEach((e => { "add" === t ? e.classList.add(r) : e.classList.remove(r) })) }), o) }(r, t, 500, s) } function R() { const e = window.innerHeight / window.innerWidth; s > e ? (o.width = window.innerHeight / s, o.height = window.innerHeight, n = window.innerHeight / 640, l.style = `--scale:${n}`) : (o.width = window.innerWidth, o.height = window.innerWidth * s, n = window.innerWidth / i, l.style = `--scale:${n}`) } setInterval((() => { r.clearRect(0, 0, o.width, o.height), P.forEach((e => { e.y >= 555 - e.radius && E && (e.speed = 0, G()), e.speed <= 0 && (e.alpha -= .04, e.alpha <= 0 && (e.alpha = 0, P.splice(e, 1))), e.update() })), $.forEach((e => { e.alpha <= 0 ? $.splice(e, 1) : e.update() })) }), 16.666), l.addEventListener("click", (e => { const o = e.target; if (o === h) { let e; N("start", "add", "left", [v]), e = k.classList.contains("hidden--right") ? "right" : "left", N(null, "remove", e, [k]), I(h, 200), q && t.Click.play() } else if (o === y) q = !q, y.classList.toggle("off"), I(y, 200), q && t.Click.play(); else if (o === f) vkBridge.send("VKWebAppJoinGroup", { group_id: 213140436 }), I(f, 200), q && t.Click.play(); else if (o === m) { const e = d.firstElementChild.textContent; vkBridge.send("VKWebAppStorageGet", { keys: ["userHighscore"] }).then((() => { vkBridge.send("VKWebAppShowWallPostBox", { message: `Мой рекорд в игре Лопай Шарики! 🌈 - ${e} ${_(e)}! сможешь побить?\n\nOrby Games (vk.com/orby.games) - бесплатные игры для ВКонтакте. Присоединяйтесь!\n\n#игры #vkgames #directgames`, attachments: "https://vk.com/app8158284" }) })), I(m, 200), q && t.Click.play() } else if (o === g) vkBridge.send("VKWebAppShowInviteBox"), I(g, 200), q && t.Click.play(); else if (o === p) N(null, "add", "right", [S]), N("start", "remove", "left", [k]), I(p, 200), q && t.Click.play(); else if (o === u) N(null, "add", "right", [S]), N(null, "remove", "left", [v]), N(null, "remove", "left", [k]), N(null, "add", "right", [k]), I(u, 200), q && t.Click.play(); else if (o.parentElement === w && E && P.length) { const e = window.getComputedStyle(o).backgroundColor, r = P.find((t => t.color === e)); if (r === P[0]) { const e = Math.floor(3 * Math.random()); t[T[e]].play(); const o = r.color; r.color = "#fff", r.radius += r.radius / 5, setTimeout((() => { r.color = o, P.shift(P.indexOf(r), 1); for (let e = 0; e < r.radius / 5; e++)$.push(new C(r.x, r.y, Math.random() * r.radius / 3, { x: (Math.random() - .5) * (20 * Math.random()), y: (Math.random() - .5) * (20 * Math.random()) }, r.color)) }), 50), A++, a.textContent = A, I(a, 200), W >= 525 && (W -= 12), H >= 525 && (H -= 16), B >= 8 && (B -= .25), L >= 14 && (L -= .15), V <= 3.5 && (V += .025) } else G() } })), R(), window.addEventListener("resize", R) })();