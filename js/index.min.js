(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var i=o.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"../audio/record.mp3",o=e.p+"../audio/click.mp3",i=e.p+"../audio/explosion_1.mp3",r=e.p+"../audio/explosion_2.mp3",s=e.p+"../audio/explosion_3.mp3",n=e.p+"../audio/end.mp3";vkBridge.send("VKWebAppInit");const a=document.querySelector("canvas"),l=a.getContext("2d"),d=360,c=640/d;a.width=d,a.height=640;let h=1;const u=document.querySelector(".wrapper"),p=document.querySelector(".score"),m=document.querySelector(".highscore"),g=document.querySelector(".result"),f=document.querySelector(".play"),y=document.querySelector(".home"),w=document.querySelector(".restart"),v=document.querySelector(".post"),S=document.querySelector(".invite"),b=document.querySelector(".buttons"),k=document.querySelector(".screen--start"),x=document.querySelector(".screen--game"),q=document.querySelector(".screen--end"),A=document.querySelector(".preloader");class C{constructor(e,t,o,i,r){this.x=e,this.y=t,this.radius=o,this.speed=i,this.color=r,this.alpha=1}draw(){l.save(),l.globalAlpha=this.alpha,l.beginPath(),l.arc(this.x*h,this.y*h,this.radius*h,0,2*Math.PI),l.fillStyle=this.color,l.fill(),l.strokeStyle="rgb(17, 21, 66)",l.stroke(),l.closePath(),l.restore()}update(){this.draw(),this.y+=this.speed}}class M{constructor(e,t,o,i,r){this.x=e,this.y=t,this.radius=o,this.speed=i,this.color=r,this.alpha=1}draw(){l.save(),l.globalAlpha=this.alpha,l.beginPath(),l.arc(this.x*h,this.y*h,this.radius*h,0,2*Math.PI),l.fillStyle=this.color,l.fill(),l.closePath(),l.restore()}update(){this.draw(),this.speed.x*=.98,this.speed.y*=.98,this.x+=this.speed.x,this.y+=this.speed.y,this.alpha-=.03}}let E=!1,W=0,B=0;vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((e=>{e.keys[0].value.length||(e.keys[0].value="0"),m.firstElementChild.textContent=e.keys[0].value,setTimeout((()=>{A.classList.add("hidden")}),1e3)}));let L=1300,T=1e3,V=60,K=70,P=1.55;const H=["--color-purple","--color-blue","--color-green","--color-yellow","--color-red"].map((e=>getComputedStyle(document.documentElement).getPropertyValue(e).trimStart())),$=[i,r,s];let _,G,I,N,j=[],D=[],F={};function O(e){let t=Math.abs(e);return t%=100,t>=5&&t<=20?"очков":(t%=10,1===t?"очко":t>=2&&t<=4?"очка":"очков")}function z(){E=!1,j.forEach((e=>{e.speed=0})),U(n),L=1300,T=1e3,V=60,K=70,P=1.55,J(null,"add","left",[x]),setTimeout((()=>{vkBridge.send("VKWebAppCheckNativeAds",{ad_format:"interstitial"}).then((()=>{vkBridge.send("VKWebAppShowNativeAds",{ad_format:"interstitial"})})),function(){const e=W;W=0,vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((o=>{W>o.keys[0].value&&(B=e,vkBridge.send("VKWebAppStorageSet",{key:"userHighscore",value:String(B)}),m.firstElementChild.textContent=B,g.classList.add("record"),U(t))})),g.firstElementChild.textContent=e,p.textContent=0,J(null,"remove","right",[q])}()}),1e3)}function R(e,t){e.classList.add("active"),setTimeout((()=>{e.classList.remove("active")}),t)}function J(e,t,o,i){let r;"start"!==e||E||setTimeout((()=>{E=!0,g.classList.remove("record"),function e(){const t=Math.random()*(L-T)+T;setTimeout((()=>{if(E){const t=Math.random()*(K-V)+V,o=t+5,i=d-t-5,r=Math.random()*(i-o)+o,s=-t,n=P,a=H[Math.floor(Math.random()*H.length)];document.hidden||j.push(new C(r,s,t,n,a)),e()}}),t)}()}),1100),r="left"===o?"hidden--left":"hidden--right",function(e,t,o=0,i){setTimeout((()=>{e.forEach((e=>{"add"===t?e.classList.add(i):e.classList.remove(i)}))}),o)}(i,t,500,r)}function Q(){const e=window.innerHeight/window.innerWidth;c>e?(a.width=window.innerHeight/c,a.height=window.innerHeight,h=window.innerHeight/640,u.style=`--scale:${h}`):(a.width=window.innerWidth,a.height=window.innerWidth*c,h=window.innerWidth/d,u.style=`--scale:${h}`)}function U(e){const t=new Audio,o=`./${e.split("../")[1]}`,i=o.split("audio/")[1].split(".")[0];t.src=o,F[i]=t,F[i].play()}_=1e3/60,I=Date.now(),function e(){requestAnimationFrame(e),G=Date.now(),N=G-I,N>_&&(I=G-N%_,l.clearRect(0,0,a.width,a.height),j.forEach((e=>{e.y>=555-e.radius&&E&&(e.speed=0,z()),e.speed<=0&&(e.alpha-=.04,e.alpha<=0&&(e.alpha=0,j.splice(e,1))),e.update()})),D.forEach((e=>{e.alpha<=0?D.splice(e,1):e.update()})))}(),u.addEventListener("click",(e=>{const t=e.target;if(t===f){let e;J("start","add","left",[k]),e=x.classList.contains("hidden--right")?"right":"left",J(null,"remove",e,[x]),R(f,200),U(o)}else if(t===v){const e=m.firstElementChild.textContent;vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((()=>{vkBridge.send("VKWebAppShowWallPostBox",{message:`Мой рекорд в игре Лопай шарики! 🌈 - ${e} ${O(e)}! сможешь побить?\n\nOrby Games (vk.com/orby.games) - бесплатные игры для ВКонтакте. Присоединяйтесь!\n\n#игры #vkgames #directgames`,attachments:"https://vk.com/app8158284"})})),R(v,200),U(o)}else if(t===S)vkBridge.send("VKWebAppShowInviteBox"),R(S,200),U(o);else if(t===w)J(null,"add","right",[q]),J("start","remove","left",[x]),R(w,200),U(o);else if(t===y)J(null,"add","right",[q]),J(null,"remove","left",[k]),J(null,"remove","left",[x]),J(null,"add","right",[x]),R(y,200),U(o);else if(t.parentElement===b&&E&&j.length){const e=window.getComputedStyle(t).backgroundColor,o=j.find((t=>t.color===e));if(o===j[0]){const e=Math.floor(3*Math.random());U($[e]),0===e?F.explosion_1.play():1===e?F.explosion_2.play():2===e&&F.explosion_3.play();const t=o.color;o.color="#fff",o.radius+=o.radius/5,setTimeout((()=>{o.color=t,j.shift(j.indexOf(o),1);for(let e=0;e<o.radius/5;e++)D.push(new M(o.x,o.y,Math.random()*o.radius/3,{x:(Math.random()-.5)*(20*Math.random()),y:(Math.random()-.5)*(20*Math.random())},o.color))}),50),W++,p.textContent=W,R(p,200),L>=525&&(L-=12),T>=525&&(T-=16),V>=8&&(V-=.25),K>=14&&(K-=.15),P<=3.5&&(P+=.025)}else z()}})),Q(),window.addEventListener("resize",Q)})();