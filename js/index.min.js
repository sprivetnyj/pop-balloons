(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var i=o.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"../audio/record.mp3",o=e.p+"../audio/click.mp3",i=e.p+"../audio/explosion_1.mp3",r=e.p+"../audio/explosion_2.mp3",s=e.p+"../audio/explosion_3.mp3",n=e.p+"../audio/end.mp3";document.addEventListener("DOMContentLoaded",(()=>{vkBridge.send("VKWebAppInit");const e=document.querySelector("canvas"),a=e.getContext("2d"),l=360,d=640/l;e.width=l,e.height=640;let c=1;const h=document.querySelector(".wrapper"),u=document.querySelector(".top"),p=document.querySelector(".score"),m=document.querySelector(".highscore"),g=document.querySelector(".result"),y=document.querySelector(".play"),f=document.querySelector(".bottom--start"),w=document.querySelector(".bottom--end"),v=document.querySelector(".home"),S=document.querySelector(".restart"),b=document.querySelector(".post"),k=document.querySelector(".invite"),x=document.querySelector(".buttons");class E{constructor(e,t,o,i,r){this.x=e,this.y=t,this.radius=o,this.speed=i,this.color=r,this.alpha=1}draw(){a.save(),a.globalAlpha=this.alpha,a.beginPath(),a.arc(this.x*c,this.y*c,this.radius*c,0,2*Math.PI),a.fillStyle=this.color,a.fill(),a.strokeStyle="rgb(17, 21, 66)",a.stroke(),a.closePath(),a.restore()}update(){this.draw(),this.y+=this.speed}}class q{constructor(e,t,o,i,r){this.x=e,this.y=t,this.radius=o,this.speed=i,this.color=r,this.alpha=1}draw(){a.save(),a.globalAlpha=this.alpha,a.beginPath(),a.arc(this.x*c,this.y*c,this.radius*c,0,2*Math.PI),a.fillStyle=this.color,a.fill(),a.closePath(),a.restore()}update(){this.draw(),this.speed.x*=.98,this.speed.y*=.98,this.x+=this.speed.x,this.y+=this.speed.y,this.alpha-=.03}}let A=!1,C=0,M=0;vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((e=>{e.keys[0].value.length||(e.keys[0].value="0"),m.firstElementChild.textContent=e.keys[0].value;const t=document.querySelector(".preloader");setTimeout((()=>{t.classList.add("hidden")}),1e3)}));let W=1300,B=1e3,L=60,T=70,V=1.55;const K=["--color-purple","--color-blue","--color-green","--color-yellow","--color-red"].map((e=>getComputedStyle(document.documentElement).getPropertyValue(e).trimStart())),P=[i,r,s];let H,_,$,G,I=[],D=[],N={};function O(){A=!1,I.forEach((e=>{e.speed=0})),J(n),W=1300,B=1e3,L=60,T=70,V=1.55,F(null,[u,x,h.parentElement],[g],600,900),vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((e=>{C>e.keys[0].value&&(M=C,vkBridge.send("VKWebAppStorageSet",{key:"userHighscore",value:String(M)}),m.firstElementChild.textContent=M,g.classList.add("visible--record"),setTimeout((()=>{J(t)}),900))})),g.firstElementChild.textContent=C,setTimeout((()=>{vkBridge.send("VKWebAppCheckNativeAds",{ad_format:"interstitial"}).then((()=>{vkBridge.send("VKWebAppShowNativeAds",{ad_format:"interstitial"}).then((()=>{z([w],"add",0)}))})).catch((()=>{z([w],"add",0)}))}),2e3)}function j(e,t){e.classList.add("active"),setTimeout((()=>{e.classList.remove("active")}),t)}function F(e,t,o,i=400,r=700){"start"!==e||A||(A=!0,C=0,p.textContent=0,function e(){const t=Math.random()*(W-B)+B;setTimeout((()=>{if(A){const t=Math.random()*(T-L)+L,o=t+5,i=l-t-5,r=Math.random()*(i-o)+o,s=-t,n=V,a=K[Math.floor(Math.random()*K.length)];document.hidden||I.push(new E(r,s,t,n,a)),e()}}),t)}()),z(t,"remove",i),z(o,"add",r)}function z(e,t,o=0){setTimeout((()=>{e.forEach((e=>{"add"===t?e.classList.add("visible"):(e.classList.remove("visible"),e===g&&e.classList.remove("visible--record"))}))}),o)}function R(){const t=window.innerHeight/window.innerWidth;d>t?(e.width=window.innerHeight/d,e.height=window.innerHeight,c=window.innerHeight/640,h.style=`--scale:${c}`):(e.width=window.innerWidth,e.height=window.innerWidth*d,c=window.innerWidth/l,h.style=`--scale:${c}`)}function J(e,t=!0){const o=new Audio,i=`./${e.split("../")[1]}`,r=i.split("audio/")[1].split(".")[0];o.src=i,N[r]=o,t&&N[r].play()}H=1e3/60,$=Date.now(),function t(){requestAnimationFrame(t),_=Date.now(),G=_-$,G>H&&($=_-G%H,a.clearRect(0,0,e.width,e.height),I.forEach((e=>{e.y>=555-e.radius&&A&&(e.speed=0,O()),e.speed<=0&&(e.alpha-=.04,e.alpha<=0&&(e.alpha=0,I.splice(e,1))),e.update()})),D.forEach((e=>{e.alpha<=0?D.splice(e,1):e.update()})))}(),h.addEventListener("click",(e=>{const t=e.target;if(t===y)F("start",[y,f,m],[u,x,h.parentElement]),j(y,200),J(o);else if(t===b)vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((()=>{vkBridge.send("VKWebAppShowWallPostBox",{message:`Мой рекорд в игре Лопай шарики! 🌈 (vk.com/app8158284) - ${m.firstElementChild.textContent} очков! сможешь побить?\n\n\n\t\t\t\t\t\tOrby Games (vk.com/orby.games) - бесплатные игры для ВКонтакте. Присоединяйтесь!\n\n\n\t\t\t\t\t\t#игры #vkgames #directgames\n\t\t\t\t\t\t`})})),j(b,200),J(o);else if(t===k)vkBridge.send("VKWebAppShowInviteBox"),j(k,200),J(o);else if(t===S)F("start",[w,g],[u,x,h.parentElement]),j(S,200),J(o);else if(t===v)F(null,[w,g],[y,f,m]),j(v,200),J(o);else if(t.parentElement===x&&A&&I.length){const e=window.getComputedStyle(t).backgroundColor,o=I.find((t=>t.color===e));if(o===I[0]){const e=Math.floor(3*Math.random());J(P[e],!1),0===e?N.explosion_1.play():1===e?N.explosion_2.play():2===e&&N.explosion_3.play();const t=o.color;o.color="#fff",o.radius+=o.radius/5,setTimeout((()=>{o.color=t,I.shift(I.indexOf(o),1);for(let e=0;e<o.radius/5;e++)D.push(new q(o.x,o.y,Math.random()*o.radius/3,{x:(Math.random()-.5)*(20*Math.random()),y:(Math.random()-.5)*(20*Math.random())},o.color))}),50),C++,p.textContent=C,j(p,200),W>=525&&(W-=12),B>=525&&(B-=16),L>=8&&(L-=.25),T>=14&&(T-=.15),V<=3.5&&(V+=.025)}else O()}})),R(),window.addEventListener("resize",R)}))})();