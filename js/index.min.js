(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var r=o.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"../audio/record.mp3",o=e.p+"../audio/click.mp3",r=e.p+"../audio/explosion_1.mp3",i=e.p+"../audio/explosion_2.mp3",s=e.p+"../audio/explosion_3.mp3",n=e.p+"../audio/end.mp3";vkBridge.send("VKWebAppInit");const l=document.querySelector("canvas"),a=l.getContext("2d"),d=360,c=640/d;l.width=d,l.height=640;let h=1;const u=document.querySelector(".wrapper"),p=document.querySelector(".score"),m=document.querySelector(".highscore"),g=document.querySelector(".result"),f=document.querySelector(".play"),y=document.querySelector(".home"),w=document.querySelector(".restart"),v=document.querySelector(".post"),S=document.querySelector(".invite"),b=document.querySelector(".volume"),k=document.querySelector(".group"),x=document.querySelector(".buttons"),q=document.querySelector(".screen--start"),A=document.querySelector(".screen--game"),C=document.querySelector(".screen--end"),M=document.querySelector(".preloader");class W{constructor(e,t,o,r,i){this.x=e,this.y=t,this.radius=o,this.speed=r,this.color=i,this.alpha=1}draw(){a.save(),a.globalAlpha=this.alpha,a.beginPath(),a.arc(this.x*h,this.y*h,this.radius*h,0,2*Math.PI),a.fillStyle=this.color,a.fill(),a.strokeStyle="rgb(17, 21, 66)",a.stroke(),a.closePath(),a.restore()}update(){this.draw(),this.y+=this.speed}}class E{constructor(e,t,o,r,i){this.x=e,this.y=t,this.radius=o,this.speed=r,this.color=i,this.alpha=1}draw(){a.save(),a.globalAlpha=this.alpha,a.beginPath(),a.arc(this.x*h,this.y*h,this.radius*h,0,2*Math.PI),a.fillStyle=this.color,a.fill(),a.closePath(),a.restore()}update(){this.draw(),this.speed.x*=.98,this.speed.y*=.98,this.x+=this.speed.x,this.y+=this.speed.y,this.alpha-=.03}}let B=!1,L=!0,V=0,K=0;vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore2"]}).then((e=>{e.keys[0].value.length||(e.keys[0].value="0"),m.firstElementChild.textContent=e.keys[0].value,setTimeout((()=>{M.classList.add("hidden")}),1e3)}));let T=1300,P=1e3,_=60,H=70,$=1.55;const G=["--color-purple","--color-blue","--color-green","--color-yellow","--color-red"].map((e=>getComputedStyle(document.documentElement).getPropertyValue(e).trimStart())),I=[r,i,s];let N,j,D,F,O=[],z=[],J={};function R(e){let t=Math.abs(e);return t%=100,t>=5&&t<=20?"очков":(t%=10,1===t?"очко":t>=2&&t<=4?"очка":"очков")}function Q(){B=!1,O.forEach((e=>{e.speed=0})),Z(n),T=1300,P=1e3,_=60,H=70,$=1.55,X(null,"add","left",[A]),setTimeout((()=>{vkBridge.send("VKWebAppCheckNativeAds",{ad_format:"interstitial"}).then((()=>{vkBridge.send("VKWebAppShowNativeAds",{ad_format:"interstitial"})})),function(){const e=V;V=0,vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore2"]}).then((o=>{e>o.keys[0].value&&(K=e,vkBridge.send("VKWebAppStorageSet",{key:"userHighscore2",value:String(K)}),m.firstElementChild.textContent=K,g.classList.add("record"),Z(t))})),g.firstElementChild.textContent=e,p.textContent=0,X(null,"remove","right",[C])}()}),1e3)}function U(e,t){e.classList.add("active"),setTimeout((()=>{e.classList.remove("active")}),t)}function X(e,t,o,r){let i;"start"!==e||B||setTimeout((()=>{B=!0,g.classList.remove("record"),function e(){const t=Math.random()*(T-P)+P;setTimeout((()=>{if(B){const t=Math.random()*(H-_)+_,o=t+5,r=d-t-5,i=Math.random()*(r-o)+o,s=-t,n=$,l=G[Math.floor(Math.random()*G.length)];document.hidden||O.push(new W(i,s,t,n,l)),e()}}),t)}()}),1100),i="left"===o?"hidden--left":"hidden--right",function(e,t,o=0,r){setTimeout((()=>{e.forEach((e=>{"add"===t?e.classList.add(r):e.classList.remove(r)}))}),o)}(r,t,500,i)}function Y(){const e=window.innerHeight/window.innerWidth;c>e?(l.width=window.innerHeight/c,l.height=window.innerHeight,h=window.innerHeight/640,u.style=`--scale:${h}`):(l.width=window.innerWidth,l.height=window.innerWidth*c,h=window.innerWidth/d,u.style=`--scale:${h}`)}function Z(e){if(L){const t=new Audio,o=`./${e.split("../")[1]}`,r=o.split("audio/")[1].split(".")[0];t.src=o,J[r]=t,J[r].play()}}N=1e3/60,D=Date.now(),function e(){requestAnimationFrame(e),j=Date.now(),F=j-D,F>N&&(D=j-F%N,a.clearRect(0,0,l.width,l.height),O.forEach((e=>{e.y>=555-e.radius&&B&&(e.speed=0,Q()),e.speed<=0&&(e.alpha-=.04,e.alpha<=0&&(e.alpha=0,O.splice(e,1))),e.update()})),z.forEach((e=>{e.alpha<=0?z.splice(e,1):e.update()})))}(),u.addEventListener("click",(e=>{const t=e.target;if(t===f){let e;X("start","add","left",[q]),e=A.classList.contains("hidden--right")?"right":"left",X(null,"remove",e,[A]),U(f,200),Z(o)}else if(t===b)L=!L,b.classList.toggle("off"),U(b,200),Z(o);else if(t===k)vkBridge.send("VKWebAppJoinGroup",{group_id:213140436}),U(k,200),Z(o);else if(t===v){const e=m.firstElementChild.textContent;vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore2"]}).then((()=>{vkBridge.send("VKWebAppShowWallPostBox",{message:`Мой рекорд в игре Лопай шарики! 🌈 - ${e} ${R(e)}! сможешь побить?\n\nOrby Games (vk.com/orby.games) - бесплатные игры для ВКонтакте. Присоединяйтесь!\n\n#игры #vkgames #directgames`,attachments:"https://vk.com/app8158284"})})),U(v,200),Z(o)}else if(t===S)vkBridge.send("VKWebAppShowInviteBox"),U(S,200),Z(o);else if(t===w)X(null,"add","right",[C]),X("start","remove","left",[A]),U(w,200),Z(o);else if(t===y)X(null,"add","right",[C]),X(null,"remove","left",[q]),X(null,"remove","left",[A]),X(null,"add","right",[A]),U(y,200),Z(o);else if(t.parentElement===x&&B&&O.length){const e=window.getComputedStyle(t).backgroundColor,o=O.find((t=>t.color===e));if(o===O[0]){const e=Math.floor(3*Math.random());Z(I[e]),0===e?J.explosion_1.play():1===e?J.explosion_2.play():2===e&&J.explosion_3.play();const t=o.color;o.color="#fff",o.radius+=o.radius/5,setTimeout((()=>{o.color=t,O.shift(O.indexOf(o),1);for(let e=0;e<o.radius/5;e++)z.push(new E(o.x,o.y,Math.random()*o.radius/3,{x:(Math.random()-.5)*(20*Math.random()),y:(Math.random()-.5)*(20*Math.random())},o.color))}),50),V++,p.textContent=V,U(p,200),T>=525&&(T-=12),P>=525&&(P-=16),_>=8&&(_-=.25),H>=14&&(H-=.15),$<=3.5&&($+=.025)}else Q()}})),Y(),window.addEventListener("resize",Y)})();