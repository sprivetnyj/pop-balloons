(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var i=o.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"../audio/record.mp3",o=e.p+"../audio/click.mp3",i=e.p+"../audio/explosion_1.mp3",r=e.p+"../audio/explosion_2.mp3",s=e.p+"../audio/explosion_3.mp3",n=e.p+"../audio/end.mp3";document.addEventListener("DOMContentLoaded",(()=>{vkBridge.send("VKWebAppInit");const e=document.querySelector("canvas"),a=e.getContext("2d"),l=360,d=640/l;e.width=l,e.height=640;let c=1;const h=document.querySelector(".wrapper"),u=document.querySelector(".top"),p=document.querySelector(".score"),m=document.querySelector(".highscore"),g=document.querySelector(".result"),y=document.querySelector(".play"),w=document.querySelector(".bottom"),f=document.querySelector(".home"),v=document.querySelector(".restart"),S=document.querySelector(".buttons");class b{constructor(e,t,o,i,r){this.x=e,this.y=t,this.radius=o,this.speed=i,this.color=r,this.alpha=1}draw(){a.save(),a.globalAlpha=this.alpha,a.beginPath(),a.arc(this.x*c,this.y*c,this.radius*c,0,2*Math.PI),a.fillStyle=this.color,a.fill(),a.strokeStyle="rgb(17, 21, 66)",a.stroke(),a.closePath(),a.restore()}update(){this.draw(),this.y+=this.speed}}class x{constructor(e,t,o,i,r){this.x=e,this.y=t,this.radius=o,this.speed=i,this.color=r,this.alpha=1}draw(){a.save(),a.globalAlpha=this.alpha,a.beginPath(),a.arc(this.x*c,this.y*c,this.radius*c,0,2*Math.PI),a.fillStyle=this.color,a.fill(),a.closePath(),a.restore()}update(){this.draw(),this.speed.x*=.98,this.speed.y*=.98,this.x+=this.speed.x,this.y+=this.speed.y,this.alpha-=.03}}let k=!1,E=0,M=0;vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((e=>{e.keys[0].value.length||(e.keys[0].value="0"),m.firstElementChild.textContent=e.keys[0].value}));let C=1300,A=1e3,q=60,L=70,W=1.55;const T=["--color-purple","--color-blue","--color-green","--color-yellow","--color-red"].map((e=>getComputedStyle(document.documentElement).getPropertyValue(e).trimStart())),P=[i,r,s];let _,B,H,V,K=[],$=[],D={};function I(){k=!1,K.forEach((e=>{e.speed=0})),O(n),C=1300,A=1e3,q=60,L=70,W=1.55,j(null,[u,S,h.parentElement],[g],600,900),vkBridge.send("VKWebAppStorageGet",{keys:["userHighscore"]}).then((e=>{E>e.keys[0].value&&(M=E,vkBridge.send("VKWebAppStorageSet",{key:"userHighscore",value:String(M)}),m.firstElementChild.textContent=M,g.classList.add("visible--record"),setTimeout((()=>{O(t)}),900))})),g.firstElementChild.textContent=E,setTimeout((()=>{vkBridge.send("VKWebAppCheckNativeAds",{ad_format:"interstitial"}).then((()=>{vkBridge.send("VKWebAppShowNativeAds",{ad_format:"interstitial"}).then((()=>{F([w],"add",0)}))})).catch((()=>{F([w],"add",0)}))}),2e3)}function N(e,t){e.classList.add("active"),setTimeout((()=>{e.classList.remove("active")}),t)}function j(e,t,o,i=400,r=700){"start"!==e||k||(k=!0,E=0,p.textContent=0,function e(){const t=Math.random()*(C-A)+A;setTimeout((()=>{if(k){const t=Math.random()*(L-q)+q,o=t+5,i=l-t-5,r=Math.random()*(i-o)+o,s=-t,n=W,a=T[Math.floor(Math.random()*T.length)];document.hidden||K.push(new b(r,s,t,n,a)),e()}}),t)}()),F(t,"remove",i),F(o,"add",r)}function F(e,t,o=0){setTimeout((()=>{e.forEach((e=>{"add"===t?e.classList.add("visible"):(e.classList.remove("visible"),e===g&&e.classList.remove("visible--record"))}))}),o)}function G(){const t=window.innerHeight/window.innerWidth;d>t?(e.width=window.innerHeight/d,e.height=window.innerHeight,c=window.innerHeight/640,h.style=`--scale:${c}`):(e.width=window.innerWidth,e.height=window.innerWidth*d,c=window.innerWidth/l,h.style=`--scale:${c}`)}function O(e,t=!0){const o=new Audio,i=`./${e.split("../")[1]}`,r=i.split("audio/")[1].split(".")[0];o.src=i,D[r]=o,t&&D[r].play()}_=1e3/60,H=Date.now(),function t(){requestAnimationFrame(t),B=Date.now(),V=B-H,V>_&&(H=B-V%_,a.clearRect(0,0,e.width,e.height),K.forEach((e=>{e.y>=555-e.radius&&k&&(e.speed=0,I()),e.speed<=0&&(e.alpha-=.04,e.alpha<=0&&(e.alpha=0,K.splice(e,1))),e.update()})),$.forEach((e=>{e.alpha<=0?$.splice(e,1):e.update()})))}(),h.addEventListener("click",(e=>{const t=e.target;if(t===y)j("start",[y,m],[u,S,h.parentElement]),N(y,200),O(o);else if(t===v)j("start",[w,g],[u,S,h.parentElement]),N(v,200),O(o);else if(t===f)j(null,[w,g],[y,m]),N(f,200),O(o);else if(t.parentElement===S&&k&&K.length){const e=window.getComputedStyle(t).backgroundColor,o=K.find((t=>t.color===e));if(o===K[0]){const e=Math.floor(3*Math.random());O(P[e],!1),0===e?D.explosion_1.play():1===e?D.explosion_2.play():2===e&&D.explosion_3.play();const t=o.color;o.color="#fff",o.radius+=o.radius/5,setTimeout((()=>{o.color=t,K.shift(K.indexOf(o),1);for(let e=0;e<o.radius/5;e++)$.push(new x(o.x,o.y,Math.random()*o.radius/3,{x:(Math.random()-.5)*(20*Math.random()),y:(Math.random()-.5)*(20*Math.random())},o.color))}),50),E++,p.textContent=E,N(p,200),C>=525&&(C-=12),A>=525&&(A-=16),q>=8&&(q-=.25),L>=14&&(L-=.15),W<=3.5&&(W+=.025)}else I()}})),G(),window.addEventListener("resize",G)}))})();